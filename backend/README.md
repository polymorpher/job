### Working directory

Unless otherwise specified, use `/backend` as your current working directory

See below for execution settings. You may also use .env for environment variables

### Initialize Python virtual environment

First, make sure [`virtualenv`](https://virtualenv.pypa.io/en/latest/) is installed. Then, use the setup script at the working directory: `/backend`

```
./setup.sh
```

### Install dependencies

```
pip install -r requirements.txt
```

### Initialize database schemas

```
python manage.py migrate 
```


### Development

First, generate a self-signed certificate:

```
cd certs
./gen.sh
```

Then go back to the working directory. Use `dev.sh` for running HTTPS server, and `dev-http.sh` for HTTP server.

### Production

#### Install systemctl service

TODO

#### With nginx

Use `./run-http.sh`. A systemctl configuration is already provided under `./deploy`. Install it using `enable.sh` with working directory changed to `./deploy`.

Note that you need to serve static content via nginx. To do so, you need to collect static files and copy them to nginx' content folder. A script is provided in `./static.sh` assuming the static content will be served at `/var/www/html/static`.

Consult nginx documentations for how HTTPS should be set up. The server configuration should proxy all non-static requests to Django server, as established by `run-http.sh`.

Here is an example snippet for server configuration:

```
location /static {
        autoindex on;
        alias /var/www/html/static;
}

location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```


#### Without nginx (not recommended)

First, make sure `certs/https.crt` and `certs/https.key` are soft-linked to appropriate CA-signed certificates, such as ones generated by Lego

Then, make sure `python` binary can access lower ports (such as using `libcap2-bin`) if you intend to use production ports (443). 

Then, use `./run.sh`. Note that you need to serve static content separately using some other ways

### User management

Create admin account:

```
python manage.py createsuperuser
```

You can use admin account to login at a running server to create user accounts and access tokens via the UI
